<!DOCTYPE html>
<html>
<head>
  <title>Ballchasing Ranks</title>
</head>
<body>
  <h1>Ballchasing Ranks</h1>
  <div id="ranks">Loading...</div>

  <script>
    const API_TOKEN = "Ay1yzdp9jAmiO5CPBUoAdSEPdFkPYG3sJCnFwf8x";
    const PLAYER_ID = "steam:76561198330826708";

    const playlists = {
      "1v1": "ranked-duels",
      "2v2": "ranked-doubles",
      "3v3": "ranked-standard"
    };

    async function fetchJSON(url) {
      const res = await fetch(url, {
        headers: { Authorization: API_TOKEN }
      });
      return res.json();
    }

    async function getRanks() {
      let output = "";

      for (const [mode, playlist] of Object.entries(playlists)) {
        const replaysUrl = `https://ballchasing.com/api/replays?player=${PLAYER_ID}&count=10&playlist=${playlist}`;
        const replays = await fetchJSON(replaysUrl);

        if (!replays.list || replays.list.length === 0) {
          output += `${mode}: No replays found<br>`;
          continue;
        }

        // Most recent replay
        const mostRecent = replays.list.sort((a, b) =>
          new Date(b.created) - new Date(a.created)
        )[0];
        const replay = await fetchJSON(`https://ballchasing.com/api/replays/${mostRecent.id}`);

        // Find the player
        let playerData = null;
        for (const team of ["blue", "orange"]) {
          playerData = replay[team].players.find(
            p => p.id.id === PLAYER_ID.split(":")[1]
          );
          if (playerData) break;
        }

        const rankName = playerData?.rank?.name || "Rank not available";
        output += `${mode}: ${rankName}<br>`;
      }

      document.getElementById("ranks").innerHTML = output;
    }

    getRanks();
  </script>
</body>
</html>
